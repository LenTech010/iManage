<!--
SPDX-FileCopyrightText: 2017-present Tobias Kunze
SPDX-License-Identifier: AGPL-3.0-only WITH LicenseRef-Imanage-AGPL-3.0-Terms

This file contains Apache-2.0 licensed contributions copyrighted by the following contributors:
SPDX-FileContributor: Raphael Michel
-->

{% load event_tags %}
{% load form_media %}
{% load html_signal %}
{% load i18n %}
{% load rules %}
{% load static %}
{% load vite %}

<!DOCTYPE html>
<html lang="{{ html_locale }}"{% if rtl %} dir="rtl" class="rtl"{% endif %}>
    <head>
        <meta charset="utf-8">
        <title>{% block title %}{% block extra_title %}{% endblock extra_title %}{% if request.event %}{{ request.event.name }} :: {% endif %}{% endblock title %}CUE</title>
        <meta name="title" content="{% block meta_title %}{% endblock meta_title %} {% if request.event %} - {{ request.event.name }} {% endif %}CUE">
        <meta name="description" content="{% block meta_description %}{% if request.event %}Schedule, talks and talk submissions for {{ request.event.name }}{% else %}Talks and talk submissions by CUE{% endif %}{% endblock meta_description %}">
            <meta name="application-name" content="CUE">
            <meta name="generator" content="CUE">
        <meta name="keywords" content="{% if request.event %}{{ request.event.name }}, {{ request.event.slug }}, {% if request.event.date_from %}{{ request.event.date_from.year }}, {% endif %}{% endif %}schedule, talks, cfp, call for papers, conference, submissions, organizer">
        <meta name="robots" content="nofollow">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#3aa57c">
        <meta name="HandheldFriendly" content="True"/>
        {% if request.event and request.event.logo %}<meta property="thumbnail" content="{{ request.event.urls.logo.full }}">{% endif %}
        {% block alternate_link %}
            <link rel="alternate" type="application/json" title="{{ request.event.name }} API" href="{{ request.event.api_urls.base.full }}" />
        {% endblock alternate_link %}

        {% include "common/includes/favicon.html" %}

        <link rel="stylesheet" type="text/css" href="{% static "vendored/font-awesome.css" %}" />
        <link rel="stylesheet" type="text/css" href="{% static "common/css/base.css" %}" />
        <link rel="stylesheet" type="text/css" href="{% static "common/css/rtl.css" %}" />
        <link rel="stylesheet" type="text/css" href="{% static "common/css/ui/dropdown.css" %}" />
        <link rel="stylesheet" type="text/css" href="{% static "common/css/ui/dialog.css" %}" />
        <link rel="stylesheet" type="text/css" href="{% static "common/css/_variables.css" %}" />

        <link rel="stylesheet" type="text/css" href="{% static "orga/css/base.css" %}" />
        <link rel="stylesheet" type="text/css" href="{% static "orga/css/rtl.css" %}" />
        <link rel="stylesheet" type="text/css" href="{% static "orga/css/ui/pagination.css" %}" />
        {% if request.event and request.event.primary_color %}<link rel="stylesheet" type="text/css" href="{{ request.event.urls.settings_css }}?target=orga" />{% endif %}
        {% block stylesheets %}{% endblock stylesheets %}
        <script src="{% static "orga/js/ui/sidebar-preload.js" %}"></script>
        <script defer src="{% static "common/js/base.js" %}"></script>
        <script defer src="{% static "orga/js/base.js" %}"></script>
        <script defer src="{% static "common/js/ui/collapse.js" %}"></script>
        <script defer src="{% static "common/js/ui/lightbox.js" %}"></script>
        {% form_media always_base=True extra_js="common/js/ui/tabs.js" extra_css="common/css/ui/tabs.css" table_media=True %}
        {% block scripts %}{% endblock scripts %}
        {{ html_head|safe }}
    </head>
    <body data-datetimeformat="{{ js_datetime_format }}" data-dateformat="{{ js_date_format }}" data-datetimelocale="{{ js_locale }}">
        <nav class="navbar fixed-top">
            <div class="navbar-left">
                {% if request.event %}
                    <span class="context-name">{{ request.event.name }}</span>
                    <span class="context-date ml-2">{{ request.event.get_date_range_display }}</span>
                {% else %}
                    <span class="context-name">IManage Platform</span>
                {% endif %}
            </div>
            <ul class="navbar-nav ml-auto">
                {% if not request.user.is_anonymous %}
                <li class="nav-item">
                    <a class="nav-link" href="{% url "orga:dashboard" %}">
                        <i class="fa fa-home mr-1"></i> Dashboard
                    </a>
                </li>
                {% endif %}
                {% if warning_update_available %}
                    <li class="nav-item">
                        <a href="{% url "orga:admin.update" %}" class="text-danger nav-link">
                            <i class="fa fa-bell"></i>
                        </a>
                    </li>
                {% endif %}
                {% block navbar_right %}{% endblock navbar_right %}
                <li class="nav-item">
                    <a class="nav-link" href="{% url "orga:user.view" %}">
                        <span class="user-name mr-2">{{ request.user.get_display_name }}</span>
                        <i class="fa fa-user-circle-o fa-lg mr-2"></i>
                    </a>
                </li>
                <li class="nav-item">
                    <form action="{% url "orga:logout" %}" method="post" class="d-inline">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-link nav-link p-0">
                            <i class="fa fa-sign-out fa-lg"></i>
                        </button>
                    </form>
                </li>
            </ul>
        </nav>
        {% if request.user.is_superuser %}
            <div class="global-top-warning">
                <i class="fa fa-exclamation-triangle"></i>
                {% blocktranslate with link=link trimmed %}
                    You’re using imanage as a superuser. This is not recommended.
                {% endblocktranslate %}
                <a href="{% url "orga:user.subuser" %}{% querystring next=request.path|urlencode %}">
                    {% translate "Please click here to switch to an administrator account." %}
                </a>
            </div>
        {% endif %}
        {% if warning_update_check_active %}
            <div class="global-top-warning">
                <a href="{% url "orga:admin.update" %}">
                    {% blocktranslate trimmed %}
                        Starting with version 1.1.0, imanage automatically checks for updates in the background.
                        During this check, anonymous data is transmitted to servers operated by the imanage
                        developers. Click on this message to find out more, disable this feature or enter your
                        email address to get notified via email if a new update arrives. This message will
                        disappear once you clicked it.
                    {% endblocktranslate %}
                </a>
            </div>
        {% endif %}
        <div id="page-wrapper">
            {% if not request.user.is_anonymous %}<aside class="nav flex-column sidebar">
                <div class="sidebar-brand">
                    <a href="{% url "orga:dashboard" %}">IManage</a>
                </div>
                <div class="sidebar-content">
                    {# Middle: Navigation Links #}
                    <div class="sidebar-section">
                        <a class="nav-link {% if url_name == "dashboard" or url_name == "event.list" or url_name == "root.main" %}active{% endif %}" href="{% url "orga:dashboard" %}">
                            <i class="fa fa-tachometer"></i>
                            <span class="sidebar-text">{% translate "Dashboard" %}</span>
                        </a>
                        <a class="nav-link {% if url_name == "organiser.list" %}active{% endif %}" href="{% url "orga:organiser.list" %}">
                            <i class="fa fa-university"></i>
                            <span class="sidebar-text">{% translate "My Conferences" %}</span>
                        </a>
                        <a class="nav-link {% if url_name == "user.view" %}active{% endif %}" href="{% url "orga:user.view" %}">
                            <i class="fa fa-user-circle-o"></i>
                            <span class="sidebar-text">{% translate "Profile" %}</span>
                        </a>
                        {% if request.event %}
                        <a class="nav-link {% if "settings." in url_name %}active{% endif %}" href="{{ request.event.orga_urls.settings }}">
                            <i class="fa fa-cog"></i>
                            <span class="sidebar-text">{% translate "Settings" %}</span>
                        </a>
                        {% else %}
                        <a class="nav-link {% if url_name == "admin.dashboard" %}active{% endif %}" href="{% url "orga:admin.dashboard" %}">
                            <i class="fa fa-cog"></i>
                            <span class="sidebar-text">{% translate "Settings" %}</span>
                        </a>
                        {% endif %}
                    </div>

                    {% if request.event %}
                        <hr class="sidebar-divider">
                        <div class="sidebar-section-title">
                            {{ request.event.name }}
                        </div>
                        <a class="nav-link {% if "cfp." in url_name %}active{% endif %}" href="{{ request.event.cfp.urls.editor }}">
                            <i class="fa fa-bullhorn"></i>
                            <span class="sidebar-text">{% translate "CfP" %}</span>
                        </a>
                        <a class="nav-link {% if "submissions." in url_name %}active{% endif %}" href="{{ request.event.orga_urls.submissions }}">
                            <i class="fa fa-sticky-note-o"></i>
                            <span class="sidebar-text">{% translate "Proposals" %}</span>
                        </a>
                        <a class="nav-link {% if "reviews." in url_name %}active{% endif %}" href="{% url "orga:reviews.dashboard" event=request.event.slug %}">
                            <i class="fa fa-eye"></i>
                            <span class="sidebar-text">{% translate "Reviews" %}</span>
                        </a>
                        <a class="nav-link {% if "organiser.teams." in url_name or "settings.team." in url_name %}active{% endif %}" href="{{ request.event.organiser.orga_urls.teams }}">
                            <i class="fa fa-users"></i>
                            <span class="sidebar-text">{% translate "Users" %}</span>
                        </a>
                    {% endif %}
                </div>
                
                <div class="sidebar-footer">
                    <div class="user-info p-3 d-flex align-items-center">
                        <i class="fa fa-user-circle fa-2x mr-3"></i>
                        <div class="text-truncate">
                            <div class="font-weight-bold sidebar-text">{{ request.user.get_display_name }}</div>
                        </div>
                    </div>
                    <form action="{% url "orga:logout" %}" method="post" class="d-inline">
                        {% csrf_token %}
                        <button type="submit" class="nav-link btn btn-link w-100 text-left border-0">
                            <i class="fa fa-sign-out"></i>
                            <span class="sidebar-text">{% translate "Logout" %}</span>
                        </button>
                    </form>
                </div>
            </aside>{% endif %}
            <main id="page-content" class="container-fluid">
                {% if messages %}
                    {% for message in messages %}
                        <div class="alert alert-{{ message.tags }}">
                            {{ message }}
                        </div>
                    {% endfor %}
                {% endif %}

                {% html_signal "imanage.orga.signals.html_above_orga_page" sender=request.event request=request %}
                {% block content %}
                {% endblock content %}
                {% html_signal "imanage.orga.signals.html_below_orga_page" sender=request.event request=request %}

                <footer class="mt-4">
                    {% include "common/powered_by.html" %}
                    {% if development_mode %}
                        <span class="text-warning">· {% translate "running in development mode" %}</span>
                    {% endif %}
                    {% if imanage_version %}
                        <span>·
                            {% if development_mode %}<a href="https://github.com/imanage/imanage/tree/{{ imanage_version }}/">{{ imanage_version }}</a>
                            {% else %}v{{ imanage_version }}{% endif %}
                        </span>
                    {% endif %}
                </footer>
            </main>
        </div>
        {% include "common/includes/modals.html" %}
    </body>
</html>
